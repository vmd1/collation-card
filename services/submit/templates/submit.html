<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Submit Message</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
    <script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>
</head>
<body class="bg-gradient-to-br from-purple-50 to-pink-50 min-h-screen py-12">
    <div class="max-w-2xl mx-auto px-4">
        <div class="bg-white rounded-2xl shadow-xl p-8">
            <h1 class="text-3xl font-bold text-gray-900 mb-2">{{ submission_heading }}</h1>
            <p class="text-gray-600 mb-8">Leave a message for {{ recipient_name }}</p>
            
            {% with messages = get_flashed_messages(with_categories=true) %}
                {% if messages %}
                    {% for category, message in messages %}
                        <div class="mb-4 p-4 rounded-lg {% if category == 'success' %}bg-green-100 text-green-800{% else %}bg-red-100 text-red-800{% endif %}">
                            {{ message }}
                        </div>
                    {% endfor %}
                {% endif %}
            {% endwith %}

            <form method="POST" enctype="multipart/form-data" class="space-y-6">
                <div>
                    <div class="flex items-center justify-between mb-2">
                        <label class="block text-sm font-medium text-gray-700">Your Name(s)</label>
                        <button type="button" id="addNameBtn" class="text-purple-600 hover:text-purple-800 font-medium text-sm flex items-center gap-1">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
                            </svg>
                            Add Person
                        </button>
                    </div>
                    <div id="nameInputs" class="space-y-2">
                        <div class="name-input-group flex gap-2">
                            <input type="text" name="names[]" required 
                                   class="flex-1 px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                                   placeholder="Enter your name">
                        </div>
                    </div>
                    <input type="hidden" name="name" id="combinedName">
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Your Message</label>
                    <div id="editor" class="bg-white border border-gray-300 rounded-lg" style="min-height: 200px;"></div>
                    <input type="hidden" name="content" id="content">
                </div>

                <div>
                    <label class="block text-sm font-medium text-gray-700 mb-2">Add Photo or Video (optional)</label>
                    <input type="file" name="image" accept="image/*,video/*" 
                           class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500">
                    <p class="text-xs text-gray-500 mt-1">Images (Max 5MB): JPG, PNG, WebP</p>
                    <p class="text-xs text-gray-500 mt-1">Videos (Max 50MB): MP4, WebM, MOV</p>
                </div>

                <button type="submit" 
                        class="w-full bg-gradient-to-r from-purple-600 to-pink-600 text-white font-semibold py-3 px-6 rounded-lg hover:from-purple-700 hover:to-pink-700 transition-all">
                    Submit Message
                </button>
            </form>
        </div>
    </div>

    <script>
        var quill = new Quill('#editor', {
            theme: 'snow',
            placeholder: 'Write your message here...',
            modules: {
                toolbar: [
                    ['bold', 'italic', 'underline'],
                    [{ 'list': 'ordered'}, { 'list': 'bullet' }],
                    ['clean']
                ]
            }
        });

        // Handle multiple names
        const nameInputsContainer = document.getElementById('nameInputs');
        const addNameBtn = document.getElementById('addNameBtn');
        
        addNameBtn.addEventListener('click', function() {
            const newInputGroup = document.createElement('div');
            newInputGroup.className = 'name-input-group flex gap-2';
            newInputGroup.innerHTML = `
                <input type="text" name="names[]" required 
                       class="flex-1 px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-purple-500 focus:border-transparent"
                       placeholder="Enter name">
                <button type="button" class="remove-name-btn px-4 py-3 bg-red-500 text-white rounded-lg hover:bg-red-600">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            `;
            nameInputsContainer.appendChild(newInputGroup);
            
            // Add remove functionality
            newInputGroup.querySelector('.remove-name-btn').addEventListener('click', function() {
                newInputGroup.remove();
            });
        });

        document.querySelector('form').addEventListener('submit', function(e) {
            var content = quill.root.innerHTML;
            document.getElementById('content').value = content;
            
            // Combine all names into comma-separated string
            const nameInputs = document.querySelectorAll('input[name="names[]"]');
            const names = Array.from(nameInputs)
                .map(input => input.value.trim())
                .filter(name => name.length > 0);
            document.getElementById('combinedName').value = names.join(', ');
        });
    </script>
</body>
</html>
